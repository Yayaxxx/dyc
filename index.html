<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#2a7ae2" />
  <title>Application d’inventaire</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Auth -->
  <div id="auth" class="container">
    <h1 class="app-title">Application d’inventaire</h1>

    <!-- Connexion -->
    <div id="login-section">
      <h2>Se connecter</h2>
      <input id="login-email" type="email" placeholder="Email" />
      <input id="login-password" type="password" placeholder="Mot de passe" />
      <button id="login-button" class="primary">Connexion</button>
      <p>Pas de compte ? <a href="#" id="show-register">Créer un compte</a></p>
    </div>

    <!-- Inscription -->
    <div id="register-section" style="display:none;">
      <h2>Créer un compte</h2>
      <input id="register-email" type="email" placeholder="Email" />
      <input id="register-password" type="password" placeholder="Mot de passe" />
      <button id="register-button" class="primary">Créer</button>
      <p>Déjà inscrit ? <a href="#" id="show-login">Se connecter</a></p>
    </div>
  </div>

  <!-- App -->
  <div id="app-section" style="display:none;">
    <header>
      <h1 class="app-title">Gestion d’inventaire</h1>
      <button id="logout-button" class="secondary">Déconnexion</button>
    </header>

    <!-- Onglets -->
    <nav id="nav-tabs" class="tabs">
      <button id="tab-chantier" class="tab active">Inventaire chantier</button>
      <button id="tab-atelier" class="tab">Inventaire atelier</button>
      <button id="manage-categories-button" class="tab">Catégories</button>
    </nav>

    <!-- Filtres + actions -->
    <section id="controls" class="controls">
      <div class="filter-group">
        <label for="category-select">Catégorie :</label>
        <select id="category-select"></select>
      </div>
      <div class="filter-group">
        <label for="chef-select">Chef d’équipe :</label>
        <select id="chef-select"></select>
      </div>
      <div class="filter-group">
        <input id="search-input" type="text" placeholder="Rechercher…" />
      </div>
      <div class="button-group">
        <button id="export-button" class="secondary">Exporter CSV</button>
        <button id="add-item-button" class="primary">Ajouter</button>
      </div>
    </section>

    <!-- Tableau -->
    <table id="inventory-table">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Catégorie</th>
          <th>Quantité</th>
          <th>Date</th>
          <th>Chantier</th>
          <th>Chef d’équipe</th>
          <th>Lieu</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- Message liste vide -->
    <div id="empty-message" style="display:none; padding:1rem; opacity:.8;">
      Aucun article pour les filtres/onglet actuels.
    </div>

    <!-- Modale article -->
    <div id="item-modal" class="modal" style="display:none;">
      <div class="modal-content">
        <h2 id="modal-title">Nouvel article</h2>
        <input id="item-name" type="text" placeholder="Nom de l’article" />
        <select id="item-category-select"></select>
        <input id="item-quantity" type="number" min="0" placeholder="Quantité" />
        <input id="item-date" type="date" />
        <input id="item-site" type="text" placeholder="Nom du chantier" />
        <input id="item-chef" type="text" placeholder="Chef d’équipe" />
        <select id="item-location">
          <option value="chantier">Chantier</option>
          <option value="atelier">Atelier</option>
        </select>
        <div class="modal-buttons">
          <button id="save-item-button" class="primary">Enregistrer</button>
          <button id="cancel-item-button" class="secondary">Annuler</button>
        </div>
      </div>
    </div>

    <!-- Modale catégories -->
    <div id="category-modal" class="modal" style="display:none;">
      <div class="modal-content">
        <h2>Gestion des catégories</h2>
        <ul id="category-list" class="category-list"></ul>
        <div class="category-add">
          <input id="new-category-name" type="text" placeholder="Nouvelle catégorie" />
          <button id="add-category-button" class="primary">Ajouter</button>
        </div>
        <div class="modal-buttons">
          <button id="close-category-button" class="secondary">Fermer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase Web SDK (modulaire via CDN ESM) -->
  <script type="module">
    // Import des SDK nécessaires
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
    // (Optionnel) Analytics – uniquement en prod HTTPS avec measurementId
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";

    // Config Firebase (storageBucket corrigé -> *.appspot.com)
    const firebaseConfig = {
      apiKey: "AIzaSyBSSRR5TtClk-mz_zP1eQAm7NRKZJ_GHfA",
      authDomain: "inventaire-dyc.firebaseapp.com",
      projectId: "inventaire-dyc",
      storageBucket: "inventaire-dyc.appspot.com",
      messagingSenderId: "420658924755",
      appId: "1:420658924755:web:a88e09d6ccfe8aac2d9826",
      measurementId: "G-FFS8WPSWS8"
    };

    // Initialisation
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    // Analytics (optionnel – ignore en local/file://)
    try { getAnalytics(app); } catch (_) {}

    // Exposer pour d'autres scripts non-ESM (si besoin)
    window.app = app;
    window.auth = auth;
    window.db = db;

    // Petit log santé (tu peux supprimer)
    console.log('[Firebase] projectId=', app.options.projectId);
  </script>

  <!-- Ton script applicatif -->
  <!-- Si ton main.js est MODULAIRE, charge-le aussi en type="module" -->
  <!-- <script type="module" src="main.js"></script> -->

  <!-- Si ton main.js n'est PAS modulaire mais lit window.auth/window.db, charge-le ainsi : -->
  <script defer src="main.js"></script>
</body>
</html>
